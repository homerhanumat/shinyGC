[{"name":"app.R","content":"## Claude chat link:\n## https://claude.ai/share/2db795ff-6a68-4591-b911-02e244423332\n\nlibrary(shiny)\nlibrary(shinyjs)\nlibrary(stringr)\n\n# â”€â”€ Scoring logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nscore_fruit <- function(name) {\n  # Special rule: jackfruit triggers 21 for whole hand (handled separately)\n  pts <- 0\n  \n  # 5 pts: two-word name\n  if (str_detect(name, \"^\\\\S+ \\\\S+$\")) pts <- pts + 5\n  \n  # 1 pt: ends in \"berry\"\n  if (str_ends(name, \"berry\")) pts <- pts + 1\n  \n  # Count vowels and consonants (letters only)\n  letters_only <- str_to_lower(str_replace_all(name, \"[^a-z]\", \"\"))\n  vowel_count <- str_count(letters_only, \"[aeiou]\")\n  consonant_count <- nchar(letters_only) - vowel_count\n  \n  # 4 pts: vowels >= consonants\n  if (vowel_count >= consonant_count) pts <- pts + 4\n  \n  # 2 pts per distinct run of 2+ vowels or 2+ consonants\n  runs <- str_extract_all(letters_only, \"[aeiou]{2,}|[^aeiou]{2,}\")[[1]]\n  pts <- pts + 2 * length(runs)\n  \n  pts\n}\n\nhand_value <- function(hand) {\n  if (\"jackfruit\" %in% hand) return(21)\n  score <- 0\n  for (fruit in hand) {\n    score <- score + score_fruit(name = fruit)\n  }\n  score\n}\n\n# â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nui <- fluidPage(\n  useShinyjs(),\n  tags$head(\n    tags$link(\n      href = \"https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Mono:wght@400;500&display=swap\",\n      rel = \"stylesheet\"\n    ),\n    tags$style(HTML(\"\n      :root {\n        --cream:  #fdf6e3;\n        --bark:   #3b2a1a;\n        --grove:  #2d6a4f;\n        --leaf:   #52b788;\n        --citrus: #f4a261;\n        --berry:  #c1121f;\n        --mist:   #e9f5ee;\n      }\n\n      * { box-sizing: border-box; margin: 0; padding: 0; }\n\n      body {\n        background-color: var(--cream);\n        background-image:\n          radial-gradient(ellipse at 10% 20%, rgba(82,183,136,.15) 0%, transparent 55%),\n          radial-gradient(ellipse at 90% 80%, rgba(244,162,97,.12) 0%, transparent 50%);\n        min-height: 100vh;\n        font-family: 'DM Mono', monospace;\n        color: var(--bark);\n        display: flex;\n        align-items: flex-start;\n        justify-content: center;\n        padding: 2rem 1rem 4rem;\n      }\n\n      .container-fluid { max-width: 680px; width: 100%; }\n\n      /* â”€â”€ Header â”€â”€ */\n      .game-header {\n        text-align: center;\n        margin-bottom: 2.5rem;\n      }\n      .game-header h1 {\n        font-family: 'Playfair Display', serif;\n        font-size: clamp(2.8rem, 8vw, 4.5rem);\n        font-weight: 900;\n        line-height: 1;\n        color: var(--grove);\n        letter-spacing: -1px;\n      }\n      .game-header h1 span { color: var(--citrus); }\n      .game-header p {\n        margin-top: .5rem;\n        font-size: .8rem;\n        letter-spacing: .12em;\n        text-transform: uppercase;\n        color: #7a6550;\n      }\n\n      /* â”€â”€ Score bar â”€â”€ */\n      .score-bar {\n        display: flex;\n        justify-content: center;\n        gap: 3rem;\n        background: var(--bark);\n        color: var(--cream);\n        border-radius: 12px;\n        padding: .9rem 2rem;\n        margin-bottom: 2rem;\n        font-size: .78rem;\n        letter-spacing: .1em;\n        text-transform: uppercase;\n      }\n      .score-bar .val {\n        font-family: 'Playfair Display', serif;\n        font-size: 1.7rem;\n        display: block;\n        letter-spacing: 0;\n        text-transform: none;\n        color: var(--leaf);\n      }\n\n      /* â”€â”€ Card area â”€â”€ */\n      .hand-area {\n        display: flex;\n        flex-direction: column;\n        gap: 1rem;\n        margin-bottom: 1.5rem;\n      }\n\n      .fruit-card {\n        background: #fff;\n        border: 2px solid #e0d5c5;\n        border-radius: 14px;\n        padding: 1rem 1.4rem;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        animation: slideIn .35s ease;\n        box-shadow: 0 2px 12px rgba(59,42,26,.06);\n        transition: border-color .2s;\n      }\n      .fruit-card:hover { border-color: var(--leaf); }\n      .fruit-card .fname {\n        font-family: 'Playfair Display', serif;\n        font-size: 1.25rem;\n        font-weight: 700;\n        color: var(--grove);\n        text-transform: capitalize;\n      }\n      .fruit-card .fpts {\n        font-size: .8rem;\n        background: var(--mist);\n        color: var(--grove);\n        border-radius: 8px;\n        padding: .25rem .7rem;\n        white-space: nowrap;\n      }\n      .fruit-card.jackfruit-card {\n        border-color: var(--citrus);\n        background: linear-gradient(135deg, #fffbf2, #fff8e7);\n      }\n      .fruit-card.jackfruit-card .fname { color: #c07020; }\n\n      @keyframes slideIn {\n        from { opacity: 0; transform: translateY(14px); }\n        to   { opacity: 1; transform: translateY(0); }\n      }\n\n      /* â”€â”€ Running total â”€â”€ */\n      .running-total {\n        text-align: center;\n        font-size: .82rem;\n        letter-spacing: .08em;\n        text-transform: uppercase;\n        color: #7a6550;\n        margin-bottom: 1.6rem;\n      }\n      .running-total .big {\n        font-family: 'Playfair Display', serif;\n        font-size: 2.8rem;\n        display: block;\n        color: var(--bark);\n        letter-spacing: -1px;\n      }\n      .running-total .big.bust { color: var(--berry); }\n      .running-total .big.blackjack { color: var(--citrus); }\n\n      /* â”€â”€ Message â”€â”€ */\n      .game-message {\n        text-align: center;\n        min-height: 1.8rem;\n        font-size: .88rem;\n        margin-bottom: 1.2rem;\n        font-style: italic;\n        color: #7a6550;\n      }\n      .game-message.bust-msg   { color: var(--berry); font-weight: 600; font-style: normal; letter-spacing: .05em; }\n      .game-message.hold-msg   { color: var(--grove); font-weight: 600; font-style: normal; }\n      .game-message.jack-msg   { color: #c07020;     font-weight: 600; font-style: normal; }\n\n      /* â”€â”€ Buttons â”€â”€ */\n      .btn-row {\n        display: flex;\n        gap: .9rem;\n        justify-content: center;\n        flex-wrap: wrap;\n        margin-bottom: 1.5rem;\n      }\n      .btn-fj {\n        font-family: 'DM Mono', monospace;\n        font-size: .82rem;\n        letter-spacing: .1em;\n        text-transform: uppercase;\n        border: 2px solid currentColor;\n        border-radius: 10px;\n        padding: .65rem 1.6rem;\n        cursor: pointer;\n        background: transparent;\n        transition: background .18s, color .18s, transform .1s;\n      }\n      .btn-fj:active { transform: scale(.96); }\n      .btn-deal  { color: var(--grove);  }\n      .btn-deal:hover  { background: var(--grove);  color: #fff; }\n      .btn-draw  { color: var(--bark);   }\n      .btn-draw:hover  { background: var(--bark);   color: #fff; }\n      .btn-hold  { color: var(--berry);  }\n      .btn-hold:hover  { background: var(--berry);  color: #fff; }\n      .btn-again { color: var(--citrus); }\n      .btn-again:hover { background: var(--citrus); color: #fff; }\n\n      /* â”€â”€ End screen â”€â”€ */\n      .end-screen {\n        text-align: center;\n        padding: 2rem 1rem;\n        border: 2px dashed var(--leaf);\n        border-radius: 16px;\n        background: var(--mist);\n        animation: slideIn .4s ease;\n      }\n      .end-screen h2 {\n        font-family: 'Playfair Display', serif;\n        font-size: 2rem;\n        color: var(--grove);\n        margin-bottom: .5rem;\n      }\n      .end-screen p { font-size: .88rem; color: #5a4535; line-height: 1.7; }\n      .end-screen .final-score {\n        font-family: 'Playfair Display', serif;\n        font-size: 3.5rem;\n        color: var(--citrus);\n        display: block;\n        margin: .8rem 0;\n      }\n\n      /* â”€â”€ Scoring legend toggle â”€â”€ */\n      details {\n        font-size: .75rem;\n        color: #8a7560;\n        border-top: 1px solid #ddd0bb;\n        padding-top: 1rem;\n        margin-top: 1rem;\n      }\n      details summary {\n        cursor: pointer;\n        letter-spacing: .08em;\n        text-transform: uppercase;\n        margin-bottom: .5rem;\n      }\n      details ul { padding-left: 1.4rem; line-height: 2; }\n    \"))\n  ),\n  \n  div(class = \"game-header\",\n      h1(HTML(\"Fruit<span>jack<\/span>\")),\n      p(\"A blackjack-style card game played with fruit\")\n  ),\n  \n  div(class = \"score-bar\",\n      div(\n        tags$span(class = \"val\", textOutput(\"ui_games_played\", inline = TRUE)),\n        \"Games played\"\n      ),\n      div(\n        tags$span(class = \"val\", textOutput(\"ui_total_score\", inline = TRUE)),\n        \"Total score\"\n      )\n  ),\n  \n  # Game panel (hidden when game over)\n  div(id = \"game_panel\",\n      div(class = \"hand-area\", uiOutput(\"hand_cards\")),\n      div(class = \"running-total\",\n          \"Hand value\",\n          uiOutput(\"ui_hand_value\")\n      ),\n      div(class = \"game-message\", id = \"game_msg\", uiOutput(\"ui_message\")),\n      div(class = \"btn-row\",\n          actionButton(\"btn_deal\",  \"Deal\",       class = \"btn-fj btn-deal\"),\n          hidden(actionButton(\"btn_draw\",  \"Draw card\",  class = \"btn-fj btn-draw\")),\n          hidden(actionButton(\"btn_hold\",  \"Hold\",       class = \"btn-fj btn-hold\")),\n          hidden(actionButton(\"btn_again\", \"Play again\", class = \"btn-fj btn-again\"))\n      ),\n      tags$details(\n        tags$summary(\"Scoring rules\"),\n        tags$ul(\n          tags$li(\"5 pts â€” two-word fruit name\"),\n          tags$li(\"1 pt  â€” name ends in 'berry'\"),\n          tags$li(\"4 pts â€” vowels â‰¥ consonants\"),\n          tags$li(\"2 pts per run of 2+ vowels or 2+ consonants in a row\"),\n          tags$li(\"ðŸŒŸ Jackfruit = entire hand worth 21 pts\"),\n          tags$li(\"Exceed 21 â†’ bust â†’ 0 pts for that round\")\n        )\n      )\n  ),\n  \n  # End-of-session panel\n  hidden(div(id = \"end_panel\",\n             div(class = \"end-screen\",\n                 h2(\"Session Complete\"),\n                 p(\"You played all 10 games.\"),\n                 tags$span(class = \"final-score\", textOutput(\"ui_final_score\")),\n                 p(\"points across 10 games\")\n             )\n  ))\n)\n\n# â”€â”€ Server â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nserver <- function(input, output, session) {\n  \n  MAX_PLAYS <- 10\n  \n  rv <- reactiveValues(\n    pool        = NULL,   # remaining fruits to draw from\n    hand        = NULL,   # current hand (character vector)\n    hand_pts    = NULL,   # per-fruit scores\n    busted      = FALSE,\n    held        = FALSE,\n    jackfruit   = FALSE,\n    games_played = 0,\n    total_score  = 0,\n    phase        = \"pre\"  # pre | playing | ended | session_over\n  )\n  \n  # â”€â”€ Deal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  observeEvent(input$btn_deal, {\n    if (rv$games_played >= MAX_PLAYS) return()\n    \n    pool <- sample(stringr::fruit)\n    rv$hand   <- pool[1:2]\n    rv$pool   <- pool[-(1:2)]\n    rv$hand_pts <- sapply(rv$hand, score_fruit)\n    rv$busted   <- FALSE\n    rv$held     <- FALSE\n    rv$jackfruit <- \"jackfruit\" %in% rv$hand\n    rv$phase    <- \"playing\"\n    \n    shinyjs::hide(\"btn_deal\")\n    shinyjs::show(\"btn_draw\")\n    shinyjs::show(\"btn_hold\")\n    shinyjs::hide(\"btn_again\")\n    \n    check_bust(rv)\n  })\n  \n  # â”€â”€ Draw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  observeEvent(input$btn_draw, {\n    if (length(rv$pool) == 0) return()\n    \n    new_fruit   <- rv$pool[1]\n    rv$pool     <- rv$pool[-1]\n    rv$hand     <- c(rv$hand, new_fruit)\n    rv$hand_pts <- c(rv$hand_pts, score_fruit(new_fruit))\n    if (new_fruit == \"jackfruit\") rv$jackfruit <- TRUE\n    \n    check_bust(rv)\n  })\n  \n  # â”€â”€ Hold â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  observeEvent(input$btn_hold, {\n    end_round(rv, held = TRUE)\n  })\n  \n  # â”€â”€ Play again â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  observeEvent(input$btn_again, {\n    if (rv$games_played >= MAX_PLAYS) {\n      shinyjs::hide(\"game_panel\")\n      shinyjs::show(\"end_panel\")\n      return()\n    }\n    rv$hand   <- NULL\n    rv$hand_pts <- NULL\n    rv$busted <- FALSE\n    rv$held   <- FALSE\n    rv$jackfruit <- FALSE\n    rv$phase  <- \"pre\"\n    \n    shinyjs::show(\"btn_deal\")\n    shinyjs::hide(\"btn_draw\")\n    shinyjs::hide(\"btn_hold\")\n    shinyjs::hide(\"btn_again\")\n  })\n  \n  # â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  \n  check_bust <- function(rv) {\n    val <- hand_value(rv$hand)\n    if (val > 21) {\n      rv$busted <- TRUE\n      end_round(rv, held = FALSE)\n    }\n  }\n  \n  end_round <- function(rv, held) {\n    rv$held  <- held\n    rv$phase <- \"round_over\"\n    rv$games_played <- rv$games_played + 1\n    \n    round_score <- if (rv$busted) 0 else hand_value(rv$hand)\n    rv$total_score <- rv$total_score + round_score\n    \n    shinyjs::hide(\"btn_draw\")\n    shinyjs::hide(\"btn_hold\")\n    \n    if (rv$games_played >= MAX_PLAYS) {\n      shinyjs::html(\"btn_again\", \"Wrap Up\")\n    }\n    shinyjs::show(\"btn_again\")\n  }\n  \n  # â”€â”€ Outputs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  \n  output$hand_cards <- renderUI({\n    req(rv$hand)\n    lapply(seq_along(rv$hand), function(i) {\n      fname <- rv$hand[i]\n      pts   <- rv$hand_pts[i]\n      is_jack <- fname == \"jackfruit\"\n      card_class <- if (is_jack) \"fruit-card jackfruit-card\" else \"fruit-card\"\n      div(class = card_class,\n          span(class = \"fname\", fname),\n          span(class = \"fpts\",\n               if (is_jack) \"ðŸŒŸ jackfruit!\" else paste(pts, \"pts\"))\n      )\n    })\n  })\n  \n  output$ui_hand_value <- renderUI({\n    req(rv$hand)\n    val <- hand_value(rv$hand)\n    cls <- if (rv$busted) \"big bust\" else if (val == 21) \"big blackjack\" else \"big\"\n    tags$span(class = cls, val)\n  })\n  \n  output$ui_message <- renderUI({\n    if (is.null(rv$hand)) {\n      div(\"Press Deal to start a round.\")\n    } else if (rv$jackfruit && !rv$busted) {\n      div(class = \"game-message jack-msg\",\n          \"ðŸŒŸ Jackfruit! Your hand is worth 21 points.\")\n    } else if (rv$busted) {\n      div(class = \"game-message bust-msg\",\n          \"BUST! You exceeded 21 â€” this round scores 0.\")\n    } else if (rv$held) {\n      val <- hand_value(rv$hand)\n      div(class = \"game-message hold-msg\",\n          paste0(\"You held with \", val, \" points.\"))\n    } else {\n      div(paste0(\"Hand total: \", hand_value(rv$hand),\n                 \". Draw another fruit or hold?\"))\n    }\n  })\n  \n  output$ui_games_played <- renderText({ rv$games_played })\n  output$ui_total_score  <- renderText({ rv$total_score  })\n  output$ui_final_score  <- renderText({ rv$total_score  })\n}\n\nshinyApp(ui, server)","type":"text"}]
