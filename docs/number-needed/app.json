[{"name":"app.R","content":"library(shiny)\nlibrary(glue)\n\n## globals\n\nnumbers_needed_plot <- function(numbs) {\n  \n  # Determine numbers sum to more than 1\n  exceed <- sum(numbs) > 1\n  \n  # Set up the plot window\n  plot(0, 0, type = \"n\",\n       xlim = c(0, 2), ylim = c(0, 2),\n       xlab = \"Sum\", ylab = \"\",\n       axes = FALSE)\n  axis(1, at = seq(0, 2, by = 0.2))\n  \n  segments(1, 0, 1, 3, lwd = 1, col = \"black\")\n  \n  total <- 0\n  for (number in numbs) {\n    segments(total, 1.5, total + number, 1.5, lwd = 3, col = \"blue\")\n    points(total + number, 1.5, pch = 19, col = \"red\")\n    total <- total + number\n  }\n  \n  \n  # Add the title\n  if (exceed) {\n    title(main = \"The sum exceeds 1!\", col.main = \"darkgreen\", font.main = 2)\n  } else {\n    title(main = \"Get another number\", col.main = \"darkred\", font.main = 2)\n  }\n}\n\n## ui\nui <- pageWithSidebar(\n  headerPanel = titlePanel(\"The Number of Numbers Needed\"),\n  sidebarPanel = sidebarPanel(\n    actionButton(\"go\", \"Get a number\"),\n    actionButton(\"restart\", \"Start Over\")\n  ),\n  mainPanel = mainPanel(\n    plotOutput(\"plot\"),\n    verbatimTextOutput(\"report\")\n  )\n)\n\n\n## server logic\nserver <- function(input, output) {\n  \n  rv <- reactiveValues(\n    numbers = numeric(),\n    total = 0,\n    plays = 0,\n    msg = \"\",\n    trying = TRUE\n  )\n  \n  observeEvent(input$restart, {\n    rv$numbers <- numeric()\n    rv$msg <- \"\"\n    rv$trying <- TRUE\n  })\n  \n  observeEvent(input$go, {\n    req(rv$trying)\n    new_number <- runif(1)\n    rv$numbers <- c(rv$numbers, new_number)\n    so_far <- length(rv$numbers)\n    #avg <- round(rv$total/ rv$plays, digits = 3)\n    msg <- glue(\n      \"{so_far} numbers so far.  They are: \n        {paste(round(rv$numbers, digits = 3), collapse =', ')}.\"\n    )\n    if (sum(rv$numbers) > 1) {\n      rv$trying <- FALSE\n      rv$plays <- rv$plays + 1\n      rv$total <- rv$total + length(rv$numbers)\n      avg <- round(rv$total / rv$plays, digits = 3)\n      more_msg <- glue(\n        \"\n        \n        The sum exceeds 1.  You are done with this try.\n        You have exceeded 1 {rv$plays} times.\n        The mean number of numbers needed so far is {avg}.\"\n      )\n      msg <- c(msg, more_msg)\n    }\n    rv$msg <- msg\n  })\n\n  output$report <- renderText({\n    rv$msg\n  })\n  \n  output$plot <- renderPlot({\n    req(length(rv$numbers) > 0)\n    numbers_needed_plot(numbs = rv$numbers)\n  })\n}\n\n# run it\nshinyApp(ui = ui, server = server)","type":"text"}]
