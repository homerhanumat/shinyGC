[{"name":"app.R","content":"library(shiny)\nlibrary(babynames)\nlibrary(tidyverse)\n\ncleanup <- function(strs) {\n  strs |> \n    str_trim() |> \n    str_to_lower()\n}\n\n## user interface:\nui <- fluidPage(\n  titlePanel(\"Compare Two Names\"),\n  sidebarLayout(\n    sidebarPanel(\n      textInput(\"name1\", label = \"First Name:\"),\n      textInput(\"name2\", label = \"Second Name:\"),\n      radioButtons(\n        \"babysex\",\n        label = \"Sex of Baby:\",\n        choices = c(\"Female\" = \"F\", \"Male\" = \"M\")\n      ),\n      actionButton(\"go\", \"Make the Line Graph\")\n    ),\n    mainPanel(\n      plotOutput(\"plot\")\n    )\n  )\n)\n\n## server logic:\nserver <- function(input, output) {\n  \n  ## this reactive makes only the data, not the plot:\n  cleaned_names <- eventReactive(input$go, {\n    cleanup(c(input$name1, input$name2))\n  })\n  \n  output$plot <- renderPlot({\n    ## this element will run when the reactive changes:\n    cleaned <- cleaned_names()\n    ## get the pre-cleaned names and the sex, \n    ## but isolate them so the element won't\n    ## run when the user is still working on names and sex:\n    isolate({\n      name1 <- input$name1\n      name2 <- input$name2\n      baby_sex <- input$babysex\n    })\n    ## find how many babies there are for each name:\n    n1 <- babynames |> filter(str_to_lower(name) == cleaned[1]) |> nrow()\n    n2 <- babynames |> filter(str_to_lower(name) == cleaned[2]) |> nrow()\n    ## if there are no babies for one or both names, stop, with\n    ## a helpful message to the user:\n    full_sex <- ifelse(\n      baby_sex == \"M\",\n      \"male\",\n      \"female\"\n    )\n    validate(\n      need(\n        n1 > 0 & n2 > 0,\n        message = case_when(\n          n1 == 0 & n2 > 0 ~ paste0(\"There are no \", full_sex, \" babies with a name like \\\"\", name1, \"\\\".\"),\n          n1 > 0 & n2 == 0 ~ paste0(\"There are no \", full_sex, \" babies with a name like \\\"\", name2, \"\\\".\"),\n          n1 == 0 & n2 == 0 ~ paste0(\"There are no \", full_sex, \" babies with names like these!\")\n        )\n      )\n    )\n    ## if we got this far, it's OK to make the dataset and graph it:\n    babynames |> \n      filter(\n        sex == baby_sex & str_to_lower(name) %in% cleaned\n      ) |> \n      mutate(perc = prop * 100) |> \n      ggplot(aes(x = year, y = perc)) +\n      geom_line(aes(color = name)) +\n      labs(x = NULL, y = \"Percentage\")\n  })\n}\n\n\n## run the app:\nshinyApp(ui, server)\n\n","type":"text"}]
