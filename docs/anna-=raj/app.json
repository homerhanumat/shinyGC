[{"name":"app.R","content":"library(shiny)\nlibrary(glue)\n\n## globals\nplay_once <- function() {\n  list(\n    anna = runif(1, min = 0, max = 60),\n    raj = runif(1, min = 0, max = 60)\n  )\n}\n\nmeetup_plot <- function(anna, raj) {\n  # Ensure that anna and raj are between 0 and 60\n  if (any(c(anna, raj) < 0 | c(anna, raj) > 60)) {\n    stop(\"Both anna and raj must be between 0 and 60.\")\n  }\n  \n  # Determine whether they meet\n  meet <- abs(anna - raj) < 10\n  \n  # Set up the plot window\n  plot(0, 0, type = \"n\",\n       xlim = c(0, 60), ylim = c(0, 3),\n       xlab = \"Minutes after 10am\", ylab = \"\",\n       axes = FALSE)\n  axis(1, at = seq(0, 60, by = 10))\n  \n  # Draw Anna’s segment (from anna to max(anna + 10, 60))\n  segments(anna, 1.5, min(anna + 10, 60), 1.5, lwd = 3, col = \"blue\")\n  points(anna, 1.5, pch = 19, col = \"blue\")\n  text(anna, 1.7, labels = \"Anna\", col = \"blue\", cex = 0.8, pos = 3)\n  \n  # Draw Raj’s segment (from raj to max(raj + 10, 60))\n  segments(raj, 2.5, min(raj + 10, 60), 2.5, lwd = 3, col = \"red\")\n  points(raj, 2.5, pch = 19, col = \"red\")\n  text(raj, 2.7, labels = \"Raj\", col = \"red\", cex = 0.8, pos = 3)\n  \n  # Add the title\n  if (meet) {\n    title(main = \"They meet!\", col.main = \"darkgreen\", font.main = 2)\n  } else {\n    title(main = \"They do not meet: sad!\", col.main = \"darkred\", font.main = 2)\n  }\n}\n\n## ui\nui <- pageWithSidebar(\n  headerPanel = titlePanel(\"Anna and Raj at the Cafe\"),\n  sidebarPanel = sidebarPanel(\n    actionButton(\"go\", \"Try to Meet\"),\n    actionButton(\"restart\", \"Start Over\")\n  ),\n  mainPanel = mainPanel(\n    plotOutput(\"plot\"),\n    verbatimTextOutput(\"report\")\n  )\n)\n\n\n## server logic\nserver <- function(input, output) {\n  \n  rv <- reactiveValues(\n    times = NA,\n    total = 0,\n    plays = 0,\n    msg = \"\"\n  )\n  \n  observeEvent(input$restart, {\n    rv$times <- NA\n    rv$total <- 0\n    rv$plays <- 0\n    rv$msg <- \"\"\n  })\n  \n  observeEvent(input$go, {\n    times <- play_once()\n    rv$times <- times\n    rv$total <- rv$total + (abs(times$anna - times$raj) < 10)\n    rv$plays <- rv$plays + 1\n    avg <- round(rv$total/ rv$plays, digits = 3)\n    msg <- glue(\n      \"After {rv$plays} tries, they met:  {rv$total} times.\n       The proportion of times they have met so far is:  {avg}.\"\n    )\n    print(msg)\n    rv$msg <- msg\n  })\n\n  output$report <- renderText({\n    rv$msg\n  })\n  \n  output$plot <- renderPlot({\n    req(!is.na(rv$times))\n    meetup_plot(anna = rv$times[[1]], raj = rv$times[[2]])\n  })\n}\n\n# run it\nshinyApp(ui = ui, server = server)","type":"text"}]
